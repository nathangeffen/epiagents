<!--
     Example and test html for using EpiAgents code
     Copyright (C) 2021  Nathan Geffen

     This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU Affero General Public License as
     published by the Free Software Foundation, either version 3 of the
     License, or (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Affero General Public License for more details.

     You should have received a copy of the GNU Affero General Public License
     along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name=viewport content="width=device-width, initial-scale=1">
        <title>Two types of infectious disease models</title>
        <link rel="stylesheet" href="epiagents.css?v=2">
        <link rel="stylesheet" href="abm_sir.css?v=6">
    </head>
    <body>
        <h1>Some notes on infectious disease modelling</h1>
        <p>By Nathan Geffen, June to November 2022</p>

        <p>
            There are numerous ways of modelling epidemics. We can broadly
            divide models into two types: macro and micro. Macro models are
            often also called compartmental or equation-based, while micro
            models are often called agent-based or individual-based simulations.
        </p>
        <p>
            At the onset of the Covid pandemic, many websites explained how the
            simplest useful macro model, an SIR one (for
            Susceptible-Infectious-Recovered), worked. We start with that and
            then try to implement an equivalent micro model. We'll then
            discuss the differences between the two models and their
            consequences for understanding real-world epidemics. Then we'll
            implement models of HIV and Covid and then consider short-duration
            (as in a short period of infectiousness) infectious diseases more
            generally.
        </p>
        <aside>
            <h1>Using the resources on this webpage</h1>
        <p>
            This webpage uses only open-source software. The text on this page
            is available for republication under <a href="https://creativecommons.org/licenses/by-sa/4.0/"> this Creative Commons license</a>.
            The Javascript and CSS files that I've written for it are available
            under one the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">GNU Affero General Public License</a>. My C and C++ code is available under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU General Public License</a>. It's
            all on <a href="">Github</a>. So please feel free to download, adapt, improve and
            publish as you see fit, but please stick to the terms of the
            licenses.
        </p>
        </aside>
        <aside>
            <h1>Terminology</h1>
            <p>
                Terminology is inconsistent across infectious disease
                literature. Macro, micro, compartmental, SIR, equation-based,
                deterministic, stochastic: all are used to describe kinds of
                models. I find the macro vs micro distinction the most useful
                here, in part because the terms are proper antonyms and using
                them in the source code makes it easier to read. Also while
                macro models are usually deterministic, they can be implemented
                stochastically. And I suppose micro models can be implemented
                deterministically, though a use-case of that doesn't spring to
                mind.
            </p>
            <p>
                Macro and micro models are broad categories and there are all
                manner of models that borrow ideas from both.
            </p>
            <p>
                For the most part, I try to stick to terminology used in <a href="https://anintroductiontoinfectiousdiseasemodelling.com/">An introduction to
                Infectious Disease Modelling</a> by Emilia Vynnycky and Richard
                G White.
            </p>
        </aside>

        <h2>A very simple disease</h2>

        <p>
            We start off with a very simple infectious disease. It has the
            following characteristics:
        </p>

        <ol>
            <li>A substantial population, at least 100 people, starts off with a
            tiny number of infected people, maybe even just one person.</li>
            <li>People in this population randomly (homogenously) mix with each
            other.</li>
            <lI>While there are a tiny number of infected people in the
                population, they will on average infect two other people before they recover.</li>
            <li>Infected people on average take 5 days to recover.</li>
            <li>Once recovered, a person has immunity. They can't become
                infected again and they can't transmit the infection to anyone else.</li>
        </ol>

        <p>Note that no-one dies and there are no births or migration into or
        out of this population, at least for the duration that we will model
        this disease.</p>

        <p>
            Characteristic 3 of our model is what's commonly called
            $\underline{R}_0$ in epidemiological literature. The real-world use
            of $\underline{R}_0$ is much more limited than is usually admitted
            but it's still useful.
        </p>

        <p>
            We call our description above a model world. We can implement both a
            macro or a micro model version of it.
        </p>

        <p>
            In this population we have people who are <b>S</b>usceptible to the
            infection, but not yet infected. There are infected people, and all
            infected people also <b>I</b>nfectious. And we have <b>R</b>ecovered people.
            That's three compartments: Susceptible, Infectious and Recovered, abbreviated as SIR.
        </p>
        <p>
            We initialize our model so that nearly everyone in the population is
            uninfected and has never had the infection. In other words everyone
            is in the Susceptible compartment and a tiny number are in the
            Infectious compartment.
        </p>
        <p>
            Let's assume the population size is 100. Then we'll set $S$, the
            number of people in the Susceptible compartment to 99 and $I$, the
            number of people in the Infectious compartment to 1. The number of
            people, $R$, in the Recovered compartment is 0. (Note we do not
            underline ${R}$, the number of recovered people, to differentiate it
            from $\underline{R}_0$, the number of people that each infectious
            person will infect when the epidemic is still very small. I wish
            this was a standard adopted throughout infectious disease
            literature.)
        </p>
        <p>
            All the above is common to both the macro and micro models that we
            implement. Now let's describe specific details of our macro model:
        </p>

        <h3>Macro Model: SIR</h3>

        <p>
            We iteratively update the $S$, $I$ and $R$ compartments with the
            number of people who have moved between them. In our model each
            iteration represents a day in our infectious disease world. These
            equations describe what happens on each iteration:
        </p>

        <p>
            Note that the number of people in our macro model compartments are
            continuous real numbers, not discrete. This is a big difference
            between our macro and micro models.
        </p>

        <p>
            The number of people who become infected on each iteration, or day,
            of our model is a function of S, I and the risk of infection $\lambda$.
            Since all three of these variables change with time, we subscript them.
            This equation describes the flow from $S$ to $I$:

            \begin{equation}
            S_{t+1}=S_t - \lambda_t S_t
            \end{equation}
        </p>

        <p>
            Since people mix homogenously, we have:

            \begin{equation} \lambda_t = \beta I_t \end{equation}

            where

            \begin{equation} \beta = {\underline{R} \over {ND}} \end{equation}

            where $N$ is the population size and $D$ is the average number of
            days a person is infected (5 in our model).
        </p>

        <p>
            The other equations in the model are simple:
        </p>
        <p>
            \begin{equation}
            I_{t+1}=I_t + \lambda_t S_t - rI_t
            \end{equation}

            \begin{equation}
            R_{t+1}=R_t + rI_t
            \end{equation}

            where $r$ is the rate of recovery per day, or $1/5$ in our model.
        </p>

        <p>
            We can depict what happens on each time step (or day) graphically:
        </p>

        <p>
            <img src="sir.svg" alt="Basic SIR graph">
        </p>


        <div id="macroSIR" class="sir"></div>
        <p>Here is a micro model for SIR</p>

        <div id="microSIR" class="sir"></div>


        <p>Let's get a bit more complicated. Here there's an exposure
            compartment before an infectious one.</p>
        <div id="macroSEIR" class="sir"></div>


        <p>Here is the highly cited Granich et al. model.</p>
        <div id="macroGranichEtAl" class="sir"></div>

        <p>Here is a quick and dirty Covid-like-disease model.</p>
        <div id="macroCovid" class="sir"></div>

        <aside>
            <h1>History of the SIR model</h1>
            <p>
                Of course, infectious disease modelling didn't start with Covid. Its
                modern form can be traced back to the English cattle plague of 18XX.
            </p>
        </aside>

        <aside>
            <h1>How useful have Covid models been?</h1>
            <p>
                The Covid pandemic ignited infectious disease modelling. Search
                "covid modelling" on <a href="https://pubmed.ncbi.nlm.nih.gov/?term=covid+modelling">Pubmed</a> and,
                at the time of writing (June 2022), you get over 3,800 pages of results. While
                not all of these papers present new models, many do and there are
                probably many more published on ArXiV and similar websites that
                never got indexed onto Pubmed.
            </p>
            <p>Were they useful?</p>
            <p>
                At the outset of the pandemic, a model by XX warned of XX million
                deaths worldwide in XX months. It was an impetus for many countries
                to take swift action against Covid, ironically less so the British
                governent. While that model was widely &mdash; in my view unfairly
                &mdash; castigated for exaggerating the scale of the pandemic, it
                turned out that even with lockdowns, physical distancing, masks,
                vaccines, improved intensive care management that between 16 and 26
                million people had died of the disease by June 2022, according to
                <a href="https://www.economist.com/graphic-detail/coronavirus-excess-deaths-estimates">The Economist</a>.
                Vaccines are estimated to have saved between 14 and 20 million
                lives, according to a study in
                <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(22)00320-6/fulltext">The Lancet</a>.
            </p>
            <p>
                These estimates were all determined by models. Without reasonably
                sophisticated models you can't really draw any strong conclusions
                about an epidemic. So, yes, models can be necessary and useful
            </p>
        </aside>

        <script src="utils.js"></script>
        <script src="epimacro.js"></script>
        <script src="epimacro-ui.js"></script>
        <script src="epimicro.js"></script>
        <script src="epimacro-ui.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async
                src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js">
        </script>
        <script src="models.js"></script>

        <!-- <script src="epiagents.js"></script> -->
    </body>
</html>

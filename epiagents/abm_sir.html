<!--
     Example and test html for using EpiAgents code
     Copyright (C) 2021  Nathan Geffen

     This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU Affero General Public License as
     published by the Free Software Foundation, either version 3 of the
     License, or (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Affero General Public License for more details.

     You should have received a copy of the GNU Affero General Public License
     along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name=viewport content="width=device-width, initial-scale=1">
        <title>Two types of infectious disease models</title>
        <link rel="stylesheet" href="epiagents.css?v=1">
        <link rel="stylesheet" href="abm_sir.css?v=5">
    </head>
    <body>
        <h1>Some notes on infectious disease modelling</h1>
        <p>Date: June to November 2022</p>

        <p>
            This webpage considers two different kinds of models, compartmental
            and agent-based ones.
        </p>
        <p>
            At the onset of the Covid pandemic, many websites explained how the
            simplest useful compartmental model, an SIR one (for
            Susceptible-Infectious-Recovered), worked. We start with that and
            then try to implement an equivalent agent-based model. We'll then
            discuss the differences between the two models and their
            consequences for understanding real-world epidemics. Then we'll
            implement models of HIV and Covid and then consider short-duration
            (as in a short period of infectiousness) infectious diseases more
            generally.
        </p>
        <aside>
            <h1>Using the resources on this webpage</h1>
        <p>
            This webpage uses only open-source software. The text on this page
            is available for republication under <a href="https://creativecommons.org/licenses/by-sa/4.0/"> this Creative Commons license</a>.
            The Javascript and CSS files that I've written for it are available
            under one the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html">GNU Affero General Public License</a>. My C and C++ code is available under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU General Public License</a>. It's
            all on <a href="">Github</a>. So please feel free to download, adapt, improve and
            publish as you see fit, but please stick to the terms of the
            licenses.
        </p>
        </aside>
        <aside>
            <h1>Terminology</h1>
            <p>
                Terminology is inconsistent across infectious disease
                literature. Compartmental models are often called macro,
                equation-based or deterministic models. Agent-based ones are often
                called micro or stochastic models. While the former are typically
                deterministic, they don't have to be. And while I stick to
                compartmental vs agent-based in the text, in my source code I have
                usually found it easier to use macro vs micro terminology.
            </p>
            <p>
                Compartmental and agent-based models are broad categories and
                there are all manner of models that borrow ideas from both.
            </p>
            <p>
                Compartmental models are also sometimes called SIR models but
                this seems especially confusing to me because SIR is a type of
                compartmental model that can also easily be implemented as an
                agent-based model.
            </p>
            <p>
                Generally, I try to stick to terminology used in <a href="https://anintroductiontoinfectiousdiseasemodelling.com/">An introduction to
                Infectious Disease Modelling</a> by Emilia Vynnycky and Richard G White.
            </p>
        </aside>

        <h2>A very simple disease</h2>

        <p>
            We start off with a very simple infectious disease. It has the following characteristics:
        </p>

        <ul>
            <li>A substantial population, at least 100 people, starts off with a
            tiny number of infected people, maybe even just one person.</li>
            <li>People in this population randomly mix with each other.</li>
            <lI>While there are a tiny number of infected people in the
                population, they will on average infect two other people before they recover.</li>
            <li>Infected people on average take 5 days to recover.</li>
            <li>Once recovered, a person has immunity. They can't become
                infected again and they can't transmit the infection to anyone else.</li>
        </ul>

        <p>Note that no-one dies and there are no births or migration into or
        out of this population, at least for the duration that we will model
        this disease.</p>

        <p>
            In this population we have people who are <b>S</b>usceptible to the
            infection, but not yet infected. There are infected people, and all
            infected people also <b>I</b>nfectious. And we have <b>R</b>ecovered people.
            That's three compartments: Susceptible, Infectious and Recovered, abbreviated as SIR.
        </p>

        <p>
            We initialize the model so that nearly everyone in the population is
            uninfected and has never had the infection. In other words everyone
            is in the Susceptible compartment and a tiny number are in the
            Infectious compartment. Let's assume the population size is
            100. Then we'll set S, the number of people in the Susceptible
            compartment to 99 and I, the number of people in the Infectious
            compartment to 1. The number of people, R, in the Recovered compartment is 0.
        </p>

        <p>
            We then iteratively update the S, I and R compartments with the
            number of people who have moved between them. In our model each
            iteration represents a day in our infectious disease world.
            These equations describe what happens on each iteration:
        </p>

        <p>
            \begin{equation}
            S_{t+1}=S_t - \lambda S_t
            \end{equation}

            \begin{equation}
            I_{t+1}=I_t + \lambda S_t - rI_t
            \end{equation}

            \begin{equation}
            R_{t+1}=R_t + rI_t
            \end{equation}
        </p>

        <p>
            This is represented in the following graph:
        </p>

        <p>
            <img src="sir.svg" alt="Basic SIR graph">
        </p>

        <p>So what are the values for Î» and <i>r</i>?</p>



        <div id="macro-basic" class="sir">
        </div>
        <div id="vaccine-strategy-1" class="epi-simulation"></div>
        <div id="vaccine-strategy-2" class="epi-simulation"></div>
        <div id="vaccine-strategy-3" class="epi-simulation"></div>

        <aside>
            <h1>History of the SIR model</h1>
            <p>
                Of course, infectious disease modelling didn't start with Covid. Its
                modern form can be traced back to the English cattle plague of 18XX.
            </p>
        </aside>

        <aside>
            <h1>How useful have Covid models been?</h1>
            <p>
                The Covid pandemic ignited infectious disease modelling. Search
                "covid modelling" on <a href="https://pubmed.ncbi.nlm.nih.gov/?term=covid+modelling">Pubmed</a> and,
                at the time of writing (June 2022), you get over 3,800 pages of results. While
                not all of these papers present new models, many do and there are
                probably many more published on ArXiV and similar websites that
                never got indexed onto Pubmed.
            </p>
            <p>Were they useful?</p>
            <p>
                At the outset of the pandemic, a model by XX warned of XX million
                deaths worldwide in XX months. It was an impetus for many countries
                to take swift action against Covid, ironically less so the British
                governent. While that model was widely &mdash; in my view unfairly
                &mdash; castigated for exaggerating the scale of the pandemic, it
                turned out that even with lockdowns, physical distancing, masks,
                vaccines, improved intensive care management that between 16 and 26
                million people had died of the disease by June 2022, according to <A href="https://www.economist.com/graphic-detail/coronavirus-excess-deaths-estimates">The Economist</a>.
                Vaccines are estimated to have saved between 14 and 20 million
                lives, according to a study in <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(22)00320-6/fulltext">The Lancet</a>.
            </p>
            <p>
                These estimates were all determined by models. Without reasonably
                sophisticated models you can't really draw any strong conclusions
                about an epidemic. So, yes, models can be necessary and useful
            </p>
        </aside>

        <script src="utils.js"></script>
        <script src="epimacro.js"></script>
        <script src="epimacro-ui.js"></script>
        <script src="epimicro.js"></script>
        <script src="epimacro-ui.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async
                src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js">
        </script>
        <script src="epiagents.js"></script>
        <script>
         /* EpiMacroUI.run(exampleMacroModel, document.getElementById('macro-basic'));

          * let div = document.getElementById("vaccine-strategy-1");
          * let sim_1 = EpiAgentsUI.create("vaccine-strategy-1", {
          *     name: "Test model",
          *     description: "Model used for testing EpiAgents",
          *     numAgents: 1000,
          *     interval: 10
          * });
          * sim_1.clear();

          * sim_1.setInitialRatios([
          *     ["SUSCEPTIBLE", 990],
          *     ["INFECTED_EXPOSED", 10]
          * ]);

          * sim_1.setInfectiousness("INFECTED_SYMPTOMATIC", 1.0);

          * sim_1.setTransitions([
          *     ["INFECTED_EXPOSED", "INFECTED_SYMPTOMATIC", 1.0],
          *     ["INFECTED_SYMPTOMATIC", "RECOVERED", 0.01],
          *     ["RECOVERED", "SUSCEPTIBLE", 0.0]
          * ]);
          * sim_1.init();
          * let sim_2 = EpiAgentsUI.create("vaccine-strategy-2", {
          *     name: "Test model 2",
          *     description: "Model 2 used for testing EpiAgents",
          *     numAgents: 500,
          *     interval: 200,
          *     movementRandomnessMean: 0.1,
          *     elasticCollisions: false
          * });
          * sim_2.init();

          * let sim_3 = EpiAgentsUI.create("vaccine-strategy-3", {
          *     name: "Test model 3",
          *     description: "Model used for testing EpiAgents",
          *     width: 400,
          *     height: 400,
          *     clusters: [
          *         {
          *             name: "A",
          *             left: 0,
          *             top: 0,
          *             right: 240,
          *             bottom: 240,
          *             border: true,
          *             borderColor: "yellow",
          *             numAgents: 10
          *         },
          *         {
          *             name: "B",
          *             left: 160,
          *             top: 160,
          *             right: 400,
          *             bottom: 400,
          *             border: true,
          *             borderColor: "red",
          *             numAgents: 20
          *         },
          *     ]
          * });
          * sim_3.init(); */
        </script>
    </body>
</html>
